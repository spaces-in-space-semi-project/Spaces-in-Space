<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <title>Signup</title>

    <style>
        .form-group {
            margin-bottom: 4px; /* Space between input groups */
        }

        label {
            display: block; /* Ensures label is above the input */
            margin-bottom: 2px; /* Space between label and input */
        }

        .error-messages {
            color: red;
            font-size: 0.8em; /* Smaller font for error messages */
            margin-top: 5px; /* Space between input and error message */
            visibility: hidden; /* Hide by default */
            height: 1em; /* Reserve space */
        }

        .error-messages.visible {
            visibility: visible; /* Show when there's an error */
        }
    </style>

    <script>
        const message = `[[${message}]]`;
        if (message) {
            alert(message);
        }
    </script>
</head>
<body>
    <div th:replace="fragments/header :: header"></div>

<!--    <main class="signup-form">-->
<!--        <form id="signupForm" th:action="@{/user/member/signup}" method="post">-->
<!--            ID : <input type="text" name="memberId" /><span class="error-messages" id="errorMemberId"> </span><br>-->
<!--            PASSWORD : <input type="password" name="memberPw" /><span class="error-messages" id="errorMemberPw"> </span><br>-->
<!--            NAME : <input type="text" name="memberName" /><span class="error-messages" id="errorMemberName"> </span><br>-->
<!--            EMAIL : <input type="email" name="memberEmail" /><span class="error-messages" id="errorMemberEmail"> </span><br>-->
<!--            PHONE : <input type="tel" name="memberPhone" /><span class="error-messages" id="errorMemberPhone"> </span><br>-->
<!--            ADDRESS : <input type="text" name="memberAddress"/><span class="error-messages" id="errorMemberAddress"> </span><br>-->
<!--            <br>-->
<!--            <button type="submit">SIGN UP</button>-->
<!--        </form>-->
<!--    </main>-->

    <main class="signup-form">
        <form id="signupForm" th:action="@{/user/member/signup}" method="post">
            <div class="form-group">
<!--                <label for="memberId">ID:</label>-->
                <input type="text" name="memberId" id="memberId" placeholder="ID" />
                <label id="label1"></label>
                <div class="error-messages" id="errorMemberId"></div>
            </div>
            <div class="form-group">
<!--                <label for="memberPw">PASSWORD:</label>-->
                <input type="password" name="memberPw" id="memberPw" placeholder="비밀번호"/>
                <div class="error-messages" id="errorMemberPw"></div>
            </div>
            <div class="form-group">
<!--                <label for="memberName">NAME:</label>-->
                <input type="text" name="memberName" id="memberName" placeholder="이름"/>
                <div class="error-messages" id="errorMemberName"></div>
            </div>
            <div class="form-group">
<!--                <label for="memberEmail">EMAIL:</label>-->
                <input type="email" name="memberEmail" id="memberEmail" placeholder="email"/>
                <div class="error-messages" id="errorMemberEmail"></div>
            </div>
            <div class="form-group">
<!--                <label for="memberPhone">PHONE:</label>-->
                <input type="tel" name="memberPhone" id="memberPhone" placeholder="전화번호"/>
                <div class="error-messages" id="errorMemberPhone"></div>
            </div>
            <div class="form-group">
<!--                <label for="memberAddress">ADDRESS:</label>-->
                <input type="text" name="memberAddress" id="memberAddress" placeholder="배송지"/>
                <div class="error-messages" id="errorMemberAddress"></div>
            </div>
            <br>
            <button>SIGN UP</button>
        </form>
    </main>

    <div th:replace="fragments/footer :: footer"></div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // document.getElementById("memberId").addEventListener("focusout", function() {
            //
            //     var memberId = document.getElementById("memberId").value;
            //
            //     if (memberId === '' || memberId.length === 0) {
            //         var label = document.getElementById("label1");
            //         label.style.color = "red";
            //         label.textContent = "공백은 ID로 사용할 수 없습니다.";
            //         return false;
            //     }
            //
            //     // AJAX 전송
            //     var xhr = new XMLHttpRequest();
            //     xhr.open("POST", "user/member/checkDuplicateId", true);
            //     xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            //
            //     xhr.onreadystatechange = function () {
            //         if (xhr.readyState === 4 && xhr.status === 200) {
            //             var result = JSON.parse(xhr.responseText);
            //             var label = document.getElementById("label1");
            //             if (result === true) {
            //                 label.style.color = "black";
            //                 label.textContent = "사용 가능한 ID 입니다.";
            //             } else {
            //                 label.style.color = "red";
            //                 label.textContent = "사용 불가능한 ID 입니다.";
            //                 document.getElementById("memberId").value = '';
            //             }
            //         }
            //     };
            //
            //     xhr.send(JSON.stringify({ memberId: memberId }));
            // });

            document.getElementById('signupForm').addEventListener('submit', async function(event) {
                let valid = true;

                // Clear previous error messages
                const errorElements = document.querySelectorAll('.error-messages');
                errorElements.forEach(el => {
                    el.innerText = '';
                    el.classList.remove('visible'); // Hide the message
                });

                // Validate ID
                const memberId = this.memberId.value.trim();
                if (!memberId) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberId');
                    errorMessage.innerText = 'ID is required.';
                    errorMessage.classList.add('visible'); // Show the message
                } else {
                    // Check for duplicate ID asynchronously
                    const response = await fetch(`/user/member/checkDuplicateId?memberId=${memberId}`);
                    const isExists = await response.json();

                    if (isExists) {
                        valid = false;
                        const errorMessage = document.getElementById('errorMemberId');
                        errorMessage.innerText = 'ID already exists.';
                        errorMessage.classList.add('visible'); // Show the message
                    }
                }

                // Validate PASSWORD
                const memberPw = this.memberPw.value.trim();
                if (!memberPw) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberPw');
                    errorMessage.innerText = 'Password is required.';
                    errorMessage.classList.add('visible');
                }

                // Validate NAME
                const memberName = this.memberName.value.trim();
                if (memberName.length < 3) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberName');
                    errorMessage.innerText = 'Name must be at least 3 characters long.';
                    errorMessage.classList.add('visible');
                }

                // Validate EMAIL
                const memberEmail = this.memberEmail.value.trim();
                if (!memberEmail) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberEmail');
                    errorMessage.innerText = 'Email is required.';
                    errorMessage.classList.add('visible');
                } else if (!/\S+@\S+\.\S+/.test(memberEmail)) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberEmail');
                    errorMessage.innerText = 'Email format is invalid.';
                    errorMessage.classList.add('visible');
                }

                // Validate PHONE
                const memberPhone = this.memberPhone.value.trim();
                if (!memberPhone) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberPhone');
                    errorMessage.innerText = 'Phone number is required.';
                    errorMessage.classList.add('visible');
                }

                // Validate ADDRESS
                const memberAddress = this.memberAddress.value.trim();
                if (!memberAddress) {
                    valid = false;
                    const errorMessage = document.getElementById('errorMemberAddress');
                    errorMessage.innerText = 'Address is required.';
                    errorMessage.classList.add('visible');
                }

                // Prevent form submission if invalid
                if (!valid) {
                    event.preventDefault();
                }
            });
        });
    </script>
</body>
</html>