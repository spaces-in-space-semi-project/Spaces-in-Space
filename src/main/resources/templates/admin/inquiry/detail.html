<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <title>답변 수정</title>

</head>
<body>

    <div th:fragment="inquiryDetail" class="container my-5">
        <h2 class="mb-4">문의글 내용</h2>
        <div class="form-container-inquiry">
            <form th:action="@{/admin/inquiry/delete/{code}(code=${ inquiry.inquiryCode })}" method="post" novalidate>
                <div class="mb-3">
                    <label for="inquiryTitle" class="form-label">문의 제목</label><input type="text" name="inquiryTitle" id="inquiryTitle" class="form-control" th:value="${ inquiry.inquiryTitle }" readonly><br>
                </div>
                <div class="mb-3">
                    <label for="inquiryDetail" class="form-label">문의 내용</label><textarea name="inquiryDetail" id="inquiryDetail" class="form-control" rows="7" th:text="${ inquiry.inquiryDetail }" readonly></textarea>
                </div>

<!--                <div class="col-12 text-end">-->
<!--                    <button type="submit" class="btn btn-danger">삭제</button>-->
<!--                </div>-->
            </form>


        <div th:if="${reply != null}" class="mt-4 form-container-inquiry">
<!--            <h6 class="text-success">답변</h6>-->
            <p><strong>답변 코드 : </strong><span th:text="${reply.replyCode}"></span></p>
            <p><strong>답변 날짜 : </strong><span th:text="${reply.replyDate}"></span></p>

            <form th:action="@{/admin/reply/update}" method="post">
                <div class="mb-3">
                    <label for="replyDetail" class="form-label">답변</label>
                    <textarea id="replyDetail" name="replyDetail" class="form-control" rows="5" th:text="${reply.replyDetail}" required></textarea>
                    <div class="invalid-feedback">내용을 입력해주세요.</div>
                </div>
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-primary">수정하기</button>
                    <button type="submit" class="btn btn-danger" onclick="confirmDelete()">삭제하기</button>
                </div>
            </form>
        </div>


        <div th:if="${reply == null}" class="form-container-inquiry mt-4 ">
            <form th:action="@{/admin/inquiry/registReply}" method="post">
                <label for="replyDetail2" class="form-label">답변</label>
                <textarea name="replyDetail2" id="replyDetail2" rows="5" class="form-control" th:text="${reply != null ? reply.replyDetail : ''}"></textarea>
                <br>
                <div class="text-end col-12">
                    <button type="submit" class="btn btn-primary submit-btn">등록</button>
                </div>
            </form>
        </div>

        <form th:action="@{/admin/reply/deleteReply/{code}(code=${reply != null ? reply.getReplyCode() : ''})}" method="post" id="deleteForm">
            <input type="hidden" name="replyCode" th:value="${reply != null ? reply.replyCode : ''}">
        </form>
    </div>
    </div>
        <script>
            // Form validation using Bootstrap
            (() => {
                'use strict';

                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                const forms = document.querySelectorAll('.needs-validation');

                // Loop over them and prevent submission
                Array.from(forms).forEach(form => {
                    form.addEventListener('submit', event => {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                        }

                        form.classList.add('was-validated');
                    }, false);
                });
            })();

            document.addEventListener('DOMContentLoaded', function () {
                const currentInquiryCode = `[[${inquiry.inquiryCode}]]`;
                // 문의글 데이터를 비동기로 가져오기
                fetch("/admin/inquiry/list")
                    .then(res => {
                        if (!res.ok) {
                            throw new Error('서버 응답 에러: ' + res.status);
                        }
                        return res.json();
                    })
                    .then(data => {
                        const inquiryCodeSelect = document.getElementById('inquiryCode');

                        // 문의글 데이터가 있는지 확인
                        if (data.length === 0) {
                            console.error("문의글 데이터가 없습니다.");
                            return;
                        }

                        // 데이터를 기반으로 옵션 생성
                        data.forEach(inquiry => {
                            const option = document.createElement('option');
                            option.value = inquiry.inquiryCode;
                            option.textContent = inquiry.inquiryCode;

                            if (inquiry.inquiryCode.toString() === currentInquiryCode.toString()) {
                                option.selected = true;
                            }

                            inquiryCodeSelect.appendChild(option);
                        });

                        inquiryCodeSelect.value = currentInquiryCode;
                    })
                    .catch(error => {
                        console.error('문의글을 불러오는 중 오류 발생:', error);
                    });
            });
            // 삭제 confirm
            function confirmDelete() {
                if (confirm("정말로 이 답변을 삭제하시겠습니까?")) {
                    document.getElementById('deleteForm').submit();
                }
            }
            // // 수정 confirm
            // function confirmUpdate() {
            //     if (confirm("답변을 수정하시겠습니까?")) {
            //         document.getElementById('updateForm').submit();
            //     }
            // }
        </script>



</body>
</html>