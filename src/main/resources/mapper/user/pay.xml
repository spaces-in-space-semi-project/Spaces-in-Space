<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.space.spacesinspace.user.pay.model.dao.PayMapper">

    <resultMap id="payResultMap" type="com.space.spacesinspace.common.dto.PayDTO">
        <id property="payCode" column="pay_code"/>
        <result property="memberCode" column="member_code"/>
        <result property="payDate" column="pay_date"/>
        <result property="payTotalCnt" column="pay_total_cnt"/>
        <result property="payTotalPrice" column="pay_total_price"/>
        <result property="payAddress" column="pay_address"/>
        <result property="payReceiver" column="pay_receiver"/>
        <result property="payDeliverPhone" column="pay_deliver_phone"/>
        <result property="payDeliverStatus" column="pay_deliever_status"/>
        <result property="payRefundYn" column="pay_refund_yn"/>
        <result property="payAccountNumber" column="pay_account_number"/>
        <result property="bankCode" column="bank_code"/>
        <result property="cardCompanyCode" column="card_company_code"/>
    </resultMap>

    <resultMap id="payDetailMap" type="com.space.spacesinspace.common.dto.PayDetailDTO">
        <id property="payDetailCode" column="pay_detail_code"/>
        <result property="payCode" column="pay_code"/>
        <result property="productCode" column="product_code"/>
        <result property="payDetailCnt" column="pay_detail_cnt"/>
        <result property="payDetailPrice" column="pay_detail_price"/>
        <result property="payDate" column="pay_date"/>
        <result property="payRefundYn" column="pay_refund_yn"/>
        <result property="productName" column="product_name"/>
        <result property="payReceiver" column="pay_receiver"/>
        <result property="payDeliverPhone" column="pay_deliver_phone"/>
        <result property="payDeliverStatus" column="pay_deliever_status"/>
        <result property="payAccountNumber" column="pay_account_number"/>
        <result property="payCardNumber" column="pay_card_number"/>
        <result property="bankName" column="bank_name"/>
        <result property="cardCompanyName" column="card_company_name"/>
    </resultMap>

    <resultMap id="payProgressMap" type="com.space.spacesinspace.common.dto.ProductDTO">
        <id property="productCode" column="product_code"/>
        <result property="categoryCode" column="category_code"/>
        <result property="productName" column="product_name"/>
        <result property="productImageOriginal" column="product_image_original"/>
        <result property="productImageThumbnail" column="product_image_thumbnail"/>
        <result property="productPrice" column="product_price"/>
        <result property="productDeliverTime" column="product_deliver_time"/>
        <result property="productDelieverCost" column="product_deliever_cost"/>
        <result property="productSize" column="product_size"/>
        <result property="productMaterial" column="product_material"/>
        <result property="productDescription" column="product_description"/>
        <result property="productDeleteYn" column="product_delete_yn"/>
    </resultMap>

    <resultMap id="authenticatedMember" type="com.space.spacesinspace.common.dto.MemberDTO">
        <id property="memberCode" column="member_code"/>
        <result property="memberId" column="member_id"/>
        <result property="memberPw" column="member_pw"/>
        <result property="memberName" column="member_name"/>
        <result property="memberEmail" column="member_email"/>
        <result property="memberPhone" column="member_phone"/>
        <result property="memberAddress" column="member_address"/>
        <result property="memberRole" column="member_role"/>
        <result property="memberDeleteYn" column="member_delete_yn"/>
    </resultMap>

    <!--사용자 전체조회-->
    <select id="findPayList" resultMap="payResultMap">
        SELECT
            a.pay_code,
            a.pay_date,
            a.pay_deliever_status,
            a.pay_total_cnt,
            a.pay_total_price
        FROM
            pay_tbl a
        JOIN
            member_tbl b ON (a.member_code = b.member_code)
        WHERE
            b.member_id = #{loggedInUsername}
        ORDER BY
            pay_code
    </select>

    <!--사용자 상세조회-->
    <select id="findPayDetail" resultMap="payDetailMap">
        SELECT
            b.pay_date,
            b.pay_code,
            c.product_name,
            a.pay_detail_cnt,
            a.pay_detail_price,
            b.pay_receiver,
            b.pay_deliver_phone,
            b.pay_refund_yn,
            b.pay_deliever_status,
            d.bank_name,
            b.pay_account_number,
            e.card_company_name
        FROM
            pay_detail_tbl a
        JOIN
            pay_tbl b ON (a.pay_code = b.pay_code)
        JOIN
            product_tbl c ON (a.product_code = c.product_code)
        JOIN
            bank_tbl d ON (b.bank_code = d.bank_code)
        JOIN
            card_company_tbl e ON (b.card_company_code = e.card_company_code)
        WHERE
            a.pay_code = #{ payCode }
    </select>

    <!--관리자 전체조회-->
    <select id="showPayList" resultMap="payResultMap">
        SELECT
            a.pay_code,
            a.pay_date,
            a.pay_deliever_status,
            a.pay_total_cnt,
            a.pay_total_price
        FROM
            pay_tbl a
        ORDER BY
            pay_code
    </select>

    <!--관리자 상세조회-->
    <select id="findAdminPayDetail" resultMap="payDetailMap">
        SELECT
            b.pay_date,
            b.pay_code,
            c.product_name,
            a.pay_detail_cnt,
            a.pay_detail_price,
            b.pay_receiver,
            b.pay_deliver_phone,
            b.pay_refund_yn,
            b.pay_deliever_status,
            d.bank_name,
            b.pay_account_number,
            e.card_company_name
        FROM
            pay_detail_tbl a
        JOIN
            pay_tbl b ON (a.pay_code = b.pay_code)
        JOIN
            product_tbl c ON (a.product_code = c.product_code)
        JOIN
            bank_tbl d ON (b.bank_code = d.bank_code)
        JOIN
            card_company_tbl e ON (b.card_company_code = e.card_company_code)
        WHERE
            a.pay_code = #{ payCode }
    </select>

    <!--사용자 결제 진행시 상품정보-->
    <select id="payProgress" parameterType="int" resultMap="payProgressMap">
        SELECT
            product_code,
            category_code,
            product_name,
            product_image_original,
            product_image_thumbnail,
            product_price,
            product_deliver_time,
            product_deliever_cost,
            product_size,
            product_material,
            product_description,
            product_delete_yn
        FROM
            product_tbl
        WHERE
            product_code = #{ productCode }
    </select>

    <!--사용자 결제 진행시 회원정보-->
    <select id="payProgressUser" parameterType="int" resultMap="authenticatedMember">
        SELECT
        member_code,
        member_id,
        member_pw,
        member_name,
        member_email,
        member_phone,
        member_address,
        member_role,
        member_delete_yn
        FROM member_tbl
        WHERE member_code = #{memberCode}
    </select>

    <!--사용자 결제내역 삭제 할시 먼저 지우는 payCode-->
    <delete id="deletePayDetailMenu" parameterType="int">
        DELETE FROM pay_detail_tbl
        WHERE pay_code = #{ payCode }
    </delete>

    <!--사용자 결제내역 삭제하는 payCode-->
    <delete id="deletePayMenu" parameterType="int">
        DELETE FROM pay_tbl
        WHERE pay_code = #{ payCode }
    </delete>

</mapper>