<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.space.spacesinspace.user.pay.model.dao.PayMapper">

    <resultMap id="payResultMap" type="com.space.spacesinspace.common.dto.PayDTO">
        <id property="payCode" column="pay_code"/>
        <result property="memberCode" column="member_code"/>
        <result property="payDate" column="pay_date"/>
        <result property="payTotalCnt" column="pay_total_cnt"/>
        <result property="payTotalPrice" column="pay_total_price"/>
        <result property="payAddress" column="pay_address"/>
        <result property="payReceiver" column="pay_receiver"/>
        <result property="payDeliverPhone" column="pay_deliver_phone"/>
        <result property="payDeliverStatus" column="pay_deliever_status"/>
        <result property="payRefundYn" column="pay_refund_yn"/>
        <result property="payAccountNumber" column="pay_account_number"/>
        <result property="bankCode" column="bank_code"/>
        <result property="cardCompanyCode" column="card_company_code"/>
    </resultMap>

    <resultMap id="payDetailMap" type="com.space.spacesinspace.common.dto.PayDetailDTO">
        <id property="payDetailCode" column="pay_detail_code"/>
        <result property="payCode" column="pay_code"/>
        <result property="productCode" column="product_code"/>
        <result property="payDetailCnt" column="pay_detail_cnt"/>
        <result property="payDetailPrice" column="pay_detail_price"/>
        <result property="payDate" column="pay_date"/>
        <result property="payRefundYn" column="pay_refund_yn"/>
        <result property="productName" column="product_name"/>
        <result property="payReceiver" column="pay_receiver"/>
        <result property="payDeliverPhone" column="pay_deliver_phone"/>
        <result property="payDeliverStatus" column="pay_deliever_status"/>
        <result property="payAccountNumber" column="pay_account_number"/>
        <result property="payCardNumber" column="pay_card_number"/>
        <result property="bankName" column="bank_name"/>
        <result property="cardCompanyName" column="card_company_name"/>
    </resultMap>

    <select id="findPayList" resultMap="payResultMap">
        SELECT
            a.pay_code,
            a.pay_date,
            a.pay_total_cnt,
            a.pay_total_price,
            a.pay_refund_yn
        FROM
            pay_tbl a
        JOIN
            member_tbl b ON (a.member_code = b.member_code)
        WHERE
            b.member_id = #{loggedInUsername}
        ORDER BY
            pay_code
    </select>

    <select id="findPayDetail" resultMap="payDetailMap">
        SELECT
        b.pay_date,
        c.product_name,
        a.pay_detail_cnt,
        a.pay_detail_price,
        b.pay_receiver,
        b.pay_deliver_phone,
        b.pay_refund_yn,
        b.pay_deliever_status,
        d.bank_name,
        b.pay_account_number,
        e.card_company_name
        FROM
        pay_detail_tbl a
        JOIN
        pay_tbl b ON (a.pay_code = b.pay_code)
        JOIN
        product_tbl c ON (a.product_code = c.product_code)
        JOIN
        bank_tbl d ON (b.bank_code = d.bank_code)
        JOIN
        card_company_tbl e ON (b.card_company_code = e.card_company_code)
        WHERE
        a.pay_code = #{ payCode }
    </select>

</mapper>